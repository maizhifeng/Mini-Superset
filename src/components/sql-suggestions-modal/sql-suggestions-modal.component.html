<!-- ä»…å½“ isOpen() ä¿¡å·ä¸º true æ—¶æ¸²æŸ“æ•´ä¸ªæ¨¡æ€æ¡† -->
@if(isOpen()) {
<!-- æ¨¡æ€æ¡†èƒŒæ™¯é®ç½©å±‚ï¼Œç‚¹å‡»å¯å…³é—­æ¨¡æ€æ¡† -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fade-in" (click)="close()">
  <!-- æ¨¡æ€æ¡†å®¹å™¨ï¼Œé˜»æ­¢ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°é®ç½©å±‚ -->
  <div class="bg-[var(--theme-bg-card)] rounded-lg shadow-xl w-full max-w-2xl p-6 m-4 flex flex-col max-h-[90vh] animate-fade-in-short" (click)="$event.stopPropagation()">
    <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
    <div class="flex justify-between items-center mb-4 flex-shrink-0">
      <h3 class="text-xl font-medium text-[var(--theme-text-primary)]">âœ¨ AI SQL å»ºè®®</h3>
      <button (click)="close()" class="w-8 h-8 flex items-center justify-center rounded-full transition-colors text-[var(--theme-text-secondary)] hover:bg-gray-100">&times;</button>
    </div>

    <!-- æ¨¡æ€æ¡†å†…å®¹åŒºåŸŸï¼Œå¯æ»šåŠ¨ -->
    <div class="flex-grow overflow-y-auto pr-2 -mr-2">
      <!-- çŠ¶æ€ä¸€ï¼šåˆå§‹åŠ è½½ä¸­ï¼ˆæ­£åœ¨ç­‰å¾…ç¬¬ä¸€ä¸ªå»ºè®®ï¼‰ -->
      @if(aiService.isLoading() && aiService.suggestions().length === 0) {
        <div class="flex flex-col items-center justify-center h-full">
          <div class="w-8 h-8 border-4 border-[var(--theme-accent-primary)] border-t-transparent rounded-full animate-spin"></div>
          <p class="mt-4 text-[var(--theme-text-secondary)]">æ­£åœ¨ç”Ÿæˆå»ºè®®ï¼Œè¯·ç¨å€™...</p>
        </div>
      <!-- çŠ¶æ€äºŒï¼šå‘ç”Ÿé”™è¯¯ -->
      } @else if (aiService.error()) {
        <div class="p-4 text-sm text-red-800 bg-red-100 border border-red-200 rounded-lg">
          <strong>é”™è¯¯:</strong> {{ aiService.error() }}
        </div>
      <!-- çŠ¶æ€ä¸‰ï¼šæ˜¾ç¤ºå»ºè®®åˆ—è¡¨ -->
      } @else {
        <div class="space-y-4">
          <!-- å¾ªç¯æ¸²æŸ“ä» AI æœåŠ¡æµå¼æ¥æ”¶åˆ°çš„æ¯ä¸ªå»ºè®® -->
          @for (suggestion of aiService.suggestions(); track suggestion) {
            <div class="bg-gray-50 border border-[var(--theme-border)] rounded-lg p-4 animate-fade-in-short">
              <p class="text-sm text-[var(--theme-text-secondary)] mb-2 font-sans">
                ğŸ’¡ {{ suggestion.description }}
                @if(!suggestion.query && !suggestion.isComplete) {
                  <span class="inline-block w-2 h-4 bg-[var(--theme-text-secondary)] animate-pulse ml-1 align-middle"></span>
                }
              </p>
              @if(suggestion.query || suggestion.isComplete) {
                <pre class="whitespace-pre-wrap break-words font-mono text-sm text-[var(--theme-text-primary)] bg-[var(--theme-bg-card)] ring-1 ring-inset ring-[var(--theme-border)] p-3 rounded-lg"><code>{{ suggestion.query }}@if(!suggestion.isComplete){<span class="inline-block w-2 h-4 bg-[var(--theme-text-primary)] animate-pulse ml-1 align-middle"></span>}</code></pre>
              }
              <div class="mt-3 text-right">
                @if(suggestion.isComplete) {
                  <button (click)="selectQuery(suggestion)" class="h-10 px-5 flex items-center justify-center rounded-md font-medium text-sm transition-colors duration-150 ease-in-out focus-visible:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--theme-bg-card)] focus:ring-[var(--theme-accent-primary)] bg-indigo-100 text-[var(--theme-accent-primary)] hover:bg-indigo-200/80">
                    ä½¿ç”¨æ­¤æŸ¥è¯¢
                  </button>
                }
              </div>
            </div>
          }
          <!-- å¦‚æœå»ºè®®åˆ—è¡¨ä¸ºç©ºä¸”å·²åœæ­¢åŠ è½½ï¼Œåˆ™æ˜¾ç¤ºç©ºçŠ¶æ€æ¶ˆæ¯ -->
          @if(aiService.suggestions().length === 0 && !aiService.isLoading()) {
            <p class="text-center text-[var(--theme-text-secondary)] mt-8">æœªèƒ½ç”Ÿæˆä»»ä½•å»ºè®®ã€‚è¯·å°è¯•ä¸åŒçš„åˆ—é€‰æ‹©ã€‚</p>
          }
        </div>
      }
    </div>

    <!-- æ¨¡æ€æ¡†è„šéƒ¨ -->
    <div class="mt-6 flex justify-end space-x-3 flex-shrink-0">
      <button (click)="close()" type="button" class="h-10 px-5 flex items-center justify-center rounded-md font-medium text-sm transition-colors duration-150 ease-in-out focus-visible:outline-none border border-[var(--theme-border)] text-[var(--theme-text-secondary)] hover:bg-gray-100 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
        å…³é—­
      </button>
    </div>
  </div>
</div>
}