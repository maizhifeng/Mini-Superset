<!-- ä»…å½“ isOpen() ä¿¡å·ä¸º true æ—¶æ¸²æŸ“æ•´ä¸ªæ¨¡æ€æ¡† -->
@if(isOpen()) {
<!-- æ¨¡æ€æ¡†èƒŒæ™¯é®ç½©å±‚ï¼Œç‚¹å‡»å¯å…³é—­æ¨¡æ€æ¡† -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fade-in" (click)="close()">
  <!-- æ¨¡æ€æ¡†å®¹å™¨ï¼Œé˜»æ­¢ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°é®ç½©å±‚ -->
  <div class="bg-[var(--md-sys-color-surface-container-high)] rounded-2xl shadow-xl w-full max-w-2xl p-6 m-4 flex flex-col max-h-[90vh] animate-fade-in-short" (click)="$event.stopPropagation()">
    <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
    <div class="flex justify-between items-center mb-4 flex-shrink-0">
      <h3 class="text-xl font-medium text-[var(--md-sys-color-on-surface)]">âœ¨ AI SQL å»ºè®®</h3>
      <button (click)="close()" class="w-10 h-10 flex items-center justify-center rounded-full transition-colors duration-150 ease-in-out focus-visible:outline-none text-[var(--md-sys-color-on-surface-variant)] hover:bg-[var(--md-sys-color-on-surface-variant)]/10 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--md-sys-color-surface-container-high)] focus-visible:ring-[var(--md-sys-color-on-surface-variant)] active:bg-[var(--md-sys-color-on-surface-variant)]/20">&times;</button>
    </div>

    <!-- æ¨¡æ€æ¡†å†…å®¹åŒºåŸŸï¼Œå¯æ»šåŠ¨ -->
    <div class="flex-grow overflow-y-auto pr-2">
      <!-- çŠ¶æ€ä¸€ï¼šåˆå§‹åŠ è½½ä¸­ï¼ˆæ­£åœ¨ç­‰å¾…ç¬¬ä¸€ä¸ªå»ºè®®ï¼‰ -->
      @if(aiService.isLoading() && aiService.suggestions().length === 0) {
        <div class="flex flex-col items-center justify-center h-full">
          <div class="w-8 h-8 border-4 border-[var(--md-sys-color-primary)] border-t-transparent rounded-full animate-spin"></div>
          <p class="mt-4 text-[var(--md-sys-color-on-surface-variant)]">æ­£åœ¨ç”Ÿæˆå»ºè®®ï¼Œè¯·ç¨å€™...</p>
        </div>
      <!-- çŠ¶æ€äºŒï¼šå‘ç”Ÿé”™è¯¯ -->
      } @else if (aiService.error()) {
        <div class="p-4 text-sm text-[var(--md-sys-color-on-error-container)] bg-[var(--md-sys-color-error-container)] rounded-lg">
          <strong>é”™è¯¯:</strong> {{ aiService.error() }}
        </div>
      <!-- çŠ¶æ€ä¸‰ï¼šæ˜¾ç¤ºå»ºè®®åˆ—è¡¨ -->
      } @else {
        <div class="space-y-4">
          <!-- å¾ªç¯æ¸²æŸ“ä» AI æœåŠ¡æµå¼æ¥æ”¶åˆ°çš„æ¯ä¸ªå»ºè®® -->
          @for (suggestion of aiService.suggestions(); track $index) {
            <div class="bg-[var(--md-sys-color-surface-container)] border border-[var(--md-sys-color-outline-variant)] rounded-lg p-4 animate-fade-in-short">
              <p class="text-sm text-[var(--md-sys-color-on-surface-variant)] mb-2 font-sans">
                ğŸ’¡ {{ suggestion.description }}
                @if(!suggestion.query && !suggestion.isComplete) {
                  <span class="inline-block w-2 h-4 bg-[var(--md-sys-color-on-surface-variant)] animate-pulse ml-1 align-middle"></span>
                }
              </p>
              @if(suggestion.query || suggestion.isComplete) {
                <pre class="whitespace-pre-wrap break-words font-mono text-sm text-[var(--md-sys-color-on-surface)] bg-[var(--md-sys-color-surface-bright)] ring-1 ring-inset ring-[var(--md-sys-color-outline-variant)] p-3 rounded-lg"><code>{{ suggestion.query }}@if(!suggestion.isComplete){<span class="inline-block w-2 h-4 bg-[var(--md-sys-color-on-surface)] animate-pulse ml-1 align-middle"></span>}</code></pre>
              }
              <div class="mt-3 text-right">
                @if(suggestion.isComplete) {
                  <button (click)="selectQuery(suggestion)" class="h-10 px-6 flex items-center justify-center rounded-full font-medium text-sm transition-all duration-150 ease-in-out focus-visible:outline-none bg-[var(--md-sys-color-secondary-container)] text-[var(--md-sys-color-on-secondary-container)] hover:shadow-md focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--md-sys-color-surface-container)] focus-visible:ring-[var(--md-sys-color-secondary)] active:shadow-none disabled:shadow-none disabled:bg-[var(--md-sys-color-on-surface)]/12 disabled:text-[var(--md-sys-color-on-surface)]/38 disabled:cursor-not-allowed">
                    ä½¿ç”¨æ­¤æŸ¥è¯¢
                  </button>
                }
              </div>
            </div>
          }
          <!-- å¦‚æœå»ºè®®åˆ—è¡¨ä¸ºç©ºä¸”å·²åœæ­¢åŠ è½½ï¼Œåˆ™æ˜¾ç¤ºç©ºçŠ¶æ€æ¶ˆæ¯ -->
          @if(aiService.suggestions().length === 0 && !aiService.isLoading()) {
            <p class="text-center text-[var(--md-sys-color-on-surface-variant)] mt-8">æœªèƒ½ç”Ÿæˆä»»ä½•å»ºè®®ã€‚è¯·å°è¯•ä¸åŒçš„åˆ—é€‰æ‹©ã€‚</p>
          }
        </div>
      }
    </div>

    <!-- æ¨¡æ€æ¡†è„šéƒ¨ -->
    <div class="mt-6 flex justify-end space-x-3 flex-shrink-0">
      <button (click)="close()" type="button" class="h-10 px-6 flex items-center justify-center rounded-full font-medium text-sm transition-colors duration-150 ease-in-out focus-visible:outline-none border border-[var(--md-sys-color-outline)] text-[var(--md-sys-color-primary)] hover:bg-[var(--md-sys-color-primary)]/10 focus-visible:border-[var(--md-sys-color-primary)] focus-visible:ring-2 focus-visible:ring-[var(--md-sys-color-primary)]/30 active:bg-[var(--md-sys-color-primary)]/20 disabled:border-[var(--md-sys-color-on-surface)]/12 disabled:text-[var(--md-sys-color-on-surface)]/38 disabled:hover:bg-transparent disabled:cursor-not-allowed">
        å…³é—­
      </button>
    </div>
  </div>
</div>
}